<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
        <title>中華民國制省等級</title>

        <style>
            html, body {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                overflow: hidden;
            }

            body {
                background: #b4def7;
                text-align: center;
                display: flex;
            }

            #roc-box {
                display: inline-block;
                flex: 1;
            }

            #roc-obj {
                width: 100%;
                height: 100%;
            }

            #province-name {
                min-width: 150px;
                margin: auto;
                font-size: 30px;
            }

            @media screen and (min-width: 100vh) {
                /* The width is greater than the height */
                #roc-box {
                    height: 100%;
                }
            }
            @media screen and (max-width: 100vh) {
                /* The width is smaller than the height */
                #roc-box {
                    width: 100%;
                }
            }
        </style>
    </head>

    <body>
        <div id="roc-box"><object id="roc-obj" data="roc.svg"></object></div>
        <!-- <div id="province-name"></div> -->
        <script>
            function createText(options)
            {
                let text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttributeNS(null, "x", options.position[0]);     
                text.setAttributeNS(null, "y", options.position[1]); 
                text.setAttributeNS(null, "font-size", options.fontSize);
                text.setAttributeNS(null, "font-weight", options.fontWeight);
                text.setAttributeNS(null, "font-family", "微軟雅黑體, Microsoft YaHei, 微軟正黑體, Microsoft JhengHei, sans-serif");
                text.setAttributeNS(null, "text-anchor", "middle");
                text.setAttributeNS(null, "dominant-baseline", "middle");
                text.appendChild(document.createTextNode(options.text));
                text.style.userSelect = "none";
                return text;
            }

            const rocObj = document.querySelector("#roc-obj");
            rocObj.addEventListener("load", () => {
                const svg = rocObj.contentDocument.querySelector('svg');
                const roc = rocObj.contentDocument.querySelector(':scope > [*|label="中華民國"]');
                const labelOffset = {
                    "新疆省": [40, 30],
                    "西藏地方": [5, -20],
                    "青海省": [0, -5],
                    "西康省": [0, -5],
                    "蒙古地方": [-35, 30],
                    "寧夏省": [15, -10],
                    "甘肅省": [-70, -60],
                    "陝西省": [13, -31],
                    "貴州省": [5, 5],
                    "湖南省": [0, -10],
                    "廣西省": [10, 5],
                    "廣東省": [35, -30],
                    "江西省": [-7, -5],
                    "福建省": [-3, 0],
                    "台灣省": [35, -3],
                    "河南省": [0, 12],
                    "江蘇省": [10, -5],
                    "山東省": [-15, 8],
                    "河北省": [-15, -10],
                    "察哈爾省": [-15, 0],
                    "熱河省": [0, 5],
                    "安東省": [8, -25],
                    "松江省": [15, -5],
                    "興安省": [10, 20],
                    "嫩江省": [-10, 7],
                    "遼寧省": [3, -8],
                    "黑龍江省": [25, 15],
                    "合江省": [0, 7],
                    "遼北省": [-15, -25],
                    "安徽省": [3, 8],
                    "吉林省": [5, 5],
                    "哈爾濱市": [0, 15],
                    "瀋陽市": [0, -15],
                    "大連市": [20, 10],
                    "北平市": [0, -10],
                    "天津市": [27, 1],
                    "青島市": [20, 10],
                    "上海市": [23, 2],
                    "南京市": [-27, -7],
                    "漢口市": [0, 15],
                    "西安市": [0, 15],
                    "重慶市": [27, 0],
                    "廣州市": [27, 0],
                    "香港市": [20, 15],
                    "澳門市": [-15, 13],
                    "桃園市": [-24, -4],
                    "台中市": [-30, 0],
                    "台南市": [-27, 3],
                    "高雄市": [-23, 18],
                    "新北市": [30, 5],
                    "台北市": [2, -12],
                };
                var provinces = [];
                for (let path of roc.querySelectorAll("path")) {
                    const label = path.getAttribute("inkscape:label");
                    const type = label.slice(-1);
                    if (type == "省" || type == "區" || type == "方" || type == "市") {
                        path.name = label;
                        provinces.push(path);
                    }
                }
                for (const province of provinces) {
                    const type = province.name.slice(-1);
                    province.style.fill = "white";
                    if (type == "市") province.style.strokeWidth = 0.8;

                    let textOptions = {};
                    const bbox = province.getBBox();
                    const offset = labelOffset[province.name] ?? [0, 0];
                    textOptions.position = [bbox.x + bbox.width / 2 + offset[0], bbox.y  + bbox.height / 2 + offset[1]];
                    if (type == "市") {
                        textOptions.fontSize = "13";
                        textOptions.fontWeight = "500";
                    } else {
                        textOptions.fontSize = "16";
                        textOptions.fontWeight = "100";
                    }
                    textOptions.text = province.name;
                    roc.appendChild(createText(textOptions));

                    province.onmouseover = () => {
                        //document.getElementById("province-name").innerText = province.name;
                        const type = province.name.slice(-1);
                        province.style.strokeWidth = 1.5;
                    }
                    province.onmouseout = () => {
                        //document.getElementById("province-name").innerText = "";
                        const type = province.name.slice(-1);
                        if (type == "市") province.style.strokeWidth = 0.8;
                        else province.style.strokeWidth = 0.2;
                    }
                }

                const maxWidth = 1109.739;
                const maxHeight = 879.69611;
                var width = maxWidth;
                var height = maxHeight;
                var centerX = width/2;
                var centerY = height/2;
                var pt = svg.createSVGPoint();
                var panning = false;
                var anchorX = 0; var anchorY = 0;
                svg.addEventListener('mousedown', event => {
                    panning = true;
                    anchorX = event.clientX; anchorY = event.clientY;
                    svg.style.cursor = "move";
                });
                svg.addEventListener('mouseup', event => {
                    panning = false;
                    svg.style.cursor = "auto";
                });
                svg.addEventListener("mousemove", event => {
                    if (panning) {
                        const diffX = event.clientX - anchorX;
                        const diffY = event.clientY - anchorY;
                        centerX -= diffX * 0.0015 * Math.sqrt(width); centerY -= diffY * 0.0015 * Math.sqrt(width);
                        if (centerX < width/2) centerX = width/2;
                        if (centerY < height/2) centerY = height/2;
                        if (centerX > maxWidth - width/2) centerX = maxWidth - width/2;
                        if (centerY > maxHeight - height/2) centerY = maxHeight - height/2;
                        svg.setAttribute("viewBox", `${centerX-width/2} ${centerY-height/2} ${width} ${height}`); 
                    }
                });
                svg.addEventListener("wheel", event => {
                    if (event.deltaY > 0) {
                        width *= 1.1;
                        height *= 1.1;
                        if (width > maxWidth) width = maxWidth;
                        if (height > maxHeight) height = maxHeight;
                    }
                    if (event.deltaY < 0) {
                        width /= 1.1;
                        height /= 1.1;
                        if (width < 100) width = 100;
                        if (height < 100) height = 100;
                    }
                    svg.setAttribute("viewBox", `${centerX-width/2} ${centerY-height/2} ${width} ${height}`); 
                });
            });
        </script>
    </body>
</html>